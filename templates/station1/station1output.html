<!DOCTYPE html>
<html>
<head>
    <title>Station 1 Dashboard</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <script>
        async function fetchData() {
            try {
                let res = await fetch("/api/station1/data");
                let data = await res.json();

                if (data.status === "ok" && data.bits2) {
                    for (let i = 0; i <= 14; i++) {  // M516 to M530
                        let bitNum = 516 + i;
                        let bitElem = document.getElementById("M" + bitNum);

                        console.log(`Updating M${bitNum} with bit value:`, data.bits2[i]);

                        if (bitElem) {
                            bitElem.className = data.bits2[i] === 1
                                ? "bit-indicator green"
                                : "bit-indicator red";
                        } else {
                            console.warn(`Element M${bitNum} not found`);
                        }
                    }
                } else {
                    console.warn("Data status not OK or bits missing", data);
                }
            } catch (error) {
                console.error("Error fetching data:", error);
            }
        }

        async function sendAction(action) {
            try {
                await fetch("/api/station1/control", {
                    method: "POST",
                    headers: {"Content-Type": "application/json"},
                    body: JSON.stringify({action: action})
                });
            } catch (error) {
                console.error("Error sending action:", error);
            }
        }

        setInterval(fetchData, 1000);
        window.onload = fetchData;
    </script>
</head>
<body>
    <h1>OUTPUT STATUS</h1>

    <div class="bit-indicator-grid">
        <div class="column"> 
            {% for i in range(516, 524) %}
            <div class="bit_pair">
                <p>Output_01(M{{ i }})</p>
                <button onclick="sendAction('button{{ i - 515 }}')">Button {{ i - 515 }} (M{{ 530 + i - 515 }})</button>
                <div class="bit-indicator red" id="M{{ i }}"></div>  
            </div>
            {% endfor %}
        </div><br><br><br><br>

        <div class="column"> 
            {% for i in range(524, 531) %}
            <div class="bit_pair">
                <p>Output_01(M{{ i }})</p>
                <button onclick="sendAction('button{{ i - 515 }}')">Button {{ i - 515 }} (M{{ 530 + i - 515 }})</button>
                <div class="bit-indicator red" id="M{{ i }}"></div>  
            </div>
            {% endfor %}
        </div>    
    </div>

    
    <div class="page-switchinput" style="margin-top: 5px;" >
        <button onclick="location.href='/'">⬅️ Back to Home</button>
        <button onclick="location.href='/station1input'">➡️ Go to Input</button>
        <button onclick="location.href='/servo1'">➡️ Go to Servo</button>
    </div>
</body>
</html>
